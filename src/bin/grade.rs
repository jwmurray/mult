use num_format::{Locale, ToFormattedString};
use std::time::{Duration, Instant};

struct big_int {
    value: Vec<u8>,
}

impl big_int {
    fn print(&self) {
        println!("{:?}", self.value);
    }
    fn new(seed: &str) -> big_int {
        big_int {
            value: seed.as_bytes().iter().map(|b| b - ('0' as u8)).collect(),
        }
    }
    fn to_string(&self) -> String {
        self.value
            .iter()
            .map(|&c| (c + '0' as u8) as char)
            .collect::<String>()
    }
}
fn grade_school_multiply(arga: &big_int, argb: &big_int) -> big_int {
    big_int {
        value: grade_mult(arga.value.to_owned(), argb.value.to_owned()),
    }
}

fn grade_mult(arga: Vec<u8>, argb: Vec<u8>) -> Vec<u8> {
    let a: Vec<u8> = arga.iter().rev().cloned().collect();
    let b: Vec<u8> = argb.iter().rev().cloned().collect();
    let capacity = a.len() + b.len();
    let mut product: Vec<u8> = vec![0; capacity];
    // let mut rows: Vec<Vec<u8>> = Vec::new();
    // let mut row:Vec<u8>

    let mut op_count = 0;
    for m in 0..a.len() {
        // rows.push(vec![0;a.len()+1]);
        for n in 0..b.len() {
            product[m + n] = product[m + n] + a[m] * b[n]; // add to prior carry value
            if product[m + n] > 9 {
                product[m + n + 1] += product[m + n] / 10;
                product[m + n] = product[m + n] % 10;
            }
            op_count += 1;
        }
    }
    // for p in 0..(capacity) {
    //     if p < capacity - 1 {
    //         product[p+1] += product[p] / 10;
    //         op_count += 1;
    //         product[p] = product[p] % 10;
    //     }
    // }
    let mut end: usize = 0;
    for i in (0..capacity).rev() {
        if product[i] != 0 {
            end = i + 1;
            break;
        }
    }
    let product: Vec<u8> = product.iter().take(end).rev().cloned().collect();
    println!(
        "n: {}, Op_count: {}",
        capacity / 2,
        op_count.to_formatted_string(&Locale::en)
    );
    product
}

fn string_mult_driver(stra: &str, strb: &str) -> String {
    let start = Instant::now();

    let product = grade_school_multiply(&big_int::new(stra), &big_int::new(strb));
    let duration = start.elapsed();
    println!("Time elapsed in expensive_function() is: {:?}", duration);

    product.to_string()
    // println!("{} x {} = \n\t{}", stra, strb, product.to_string());
}

fn main() {
    let mut strings: Vec<(&str, &str)> = vec![];

    strings.push(("1234", "5678"));
    strings.push(("56781234", "56785678"));
    strings.push(("567856781234", "567856785678"));
    // strings.push((
    //     "567856781234567856781234567856781234567856781234567856781234567856781234",
    //     "567856781234567856781234567856781234567856781234567856781234567856785678",
    // ));

    // strings.push(("567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234",
    //               "567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856785678"));

    // strings.push(("567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234",
    //               "567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856781234567856785678"));

    strings.push((
        "3141592653589793238462643383279502884197169399375105820974944592",
        "2718281828459045235360287471352662497757247093699959574966967627",
    ));

    for str_tuple in strings {
        let out_string = string_mult_driver(str_tuple.0, str_tuple.1);
        println!("{} x {} = \n\t{}", str_tuple.0, str_tuple.1, out_string);
    }
}
